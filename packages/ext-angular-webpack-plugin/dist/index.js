'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require('@babel/polyfill');

class ExtWebpackPlugin {
  constructor(options) {
    this.plugin = require(`./pluginUtil`)._constructor(options);
  }

  apply(compiler) {
    require('./pluginUtil').logv(this.plugin.options, 'FUNCTION apply');

    if (compiler.hooks) {
      compiler.hooks.thisCompilation.tap(`ext-this-compilation`, compilation => {
        require('./pluginUtil').logv(this.plugin.options, 'HOOK thisCompilation');

        if (this.plugin.vars.pluginErrors.length > 0) {
          compilation.errors.push(new Error(this.plugin.vars.pluginErrors.join("")));
        } else {//this.plugin.vars.deps = []
        }
      });

      if (this.plugin.vars.pluginErrors.length > 0) {
        return;
      }

      if (this.plugin.vars.framework == 'extjs') {
        compiler.hooks.afterCompile.tap('ext-after-compile', compilation => {
          require('./pluginUtil').logv(this.plugin.options, 'HOOK afterCompile');

          require(`./extjsUtil`)._afterCompile(compilation, this.plugin.vars, this.plugin.options);
        });
      } else {
        compiler.hooks.compilation.tap(`ext-compilation`, compilation => {
          require('./pluginUtil').logv(this.plugin.options, 'HOOK compilation');

          require(`./pluginUtil`)._compilation(compiler, compilation, this.plugin.vars, this.plugin.options);
        });
      }

      if (!this.plugin.options.genProdData) {
        compiler.hooks.emit.tapAsync(`ext-emit`, (compilation, callback) => {
          require('./pluginUtil').logv(this.plugin.options, 'HOOK emit');

          require(`./pluginUtil`).emit(compiler, compilation, this.plugin.vars, this.plugin.options, callback);
        });
        compiler.hooks.done.tap(`ext-done`, () => {
          require('./pluginUtil').logv(this.plugin.options, 'HOOK done');

          console.error('here');
          console.log(this.plugin.vars.production);

          if (this.plugin.vars.production && !this.plugin.options.genProdData && this.plugin.options.framework == 'angular') {
            console.error('clean up needed');
          }

          try {
            if (this.plugin.options.browser == true && this.plugin.options.watch == 'yes' && this.plugin.vars.production == false) {
              if (this.plugin.vars.browserCount == 0) {
                //if (this.plugin.vars.browserCount == 0 && compilation.errors.length == 0) {
                var url = 'http://localhost:' + this.plugin.options.port;

                require('./pluginUtil').log(this.plugin.vars.app + `Opening browser at ${url}`);

                this.plugin.vars.browserCount++;

                const opn = require('opn');

                opn(url);
              }
            }
          } catch (e) {
            console.log(e);
          }

          require('./pluginUtil').log(this.plugin.vars.app + `Completed ext-webpack-plugin processing`);
        });
      }
    } else {
      console.log('not webpack 4');
    }
  }

}

exports.default = ExtWebpackPlugin;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiRXh0V2VicGFja1BsdWdpbiIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInBsdWdpbiIsIl9jb25zdHJ1Y3RvciIsImFwcGx5IiwiY29tcGlsZXIiLCJsb2d2IiwiaG9va3MiLCJ0aGlzQ29tcGlsYXRpb24iLCJ0YXAiLCJjb21waWxhdGlvbiIsInZhcnMiLCJwbHVnaW5FcnJvcnMiLCJsZW5ndGgiLCJlcnJvcnMiLCJwdXNoIiwiRXJyb3IiLCJqb2luIiwiZnJhbWV3b3JrIiwiYWZ0ZXJDb21waWxlIiwiX2FmdGVyQ29tcGlsZSIsIl9jb21waWxhdGlvbiIsImdlblByb2REYXRhIiwiZW1pdCIsInRhcEFzeW5jIiwiY2FsbGJhY2siLCJkb25lIiwiY29uc29sZSIsImVycm9yIiwibG9nIiwicHJvZHVjdGlvbiIsImJyb3dzZXIiLCJ3YXRjaCIsImJyb3dzZXJDb3VudCIsInVybCIsInBvcnQiLCJhcHAiLCJvcG4iLCJlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUNBQSxPQUFPLENBQUMsaUJBQUQsQ0FBUDs7QUFFZSxNQUFNQyxnQkFBTixDQUF1QjtBQUNwQ0MsRUFBQUEsV0FBVyxDQUFDQyxPQUFELEVBQVU7QUFDbkIsU0FBS0MsTUFBTCxHQUFjSixPQUFPLENBQUUsY0FBRixDQUFQLENBQXdCSyxZQUF4QixDQUFxQ0YsT0FBckMsQ0FBZDtBQUNEOztBQUNERyxFQUFBQSxLQUFLLENBQUNDLFFBQUQsRUFBVztBQUNkUCxJQUFBQSxPQUFPLENBQUMsY0FBRCxDQUFQLENBQXdCUSxJQUF4QixDQUE2QixLQUFLSixNQUFMLENBQVlELE9BQXpDLEVBQWlELGdCQUFqRDs7QUFDQSxRQUFJSSxRQUFRLENBQUNFLEtBQWIsRUFBb0I7QUFFbEJGLE1BQUFBLFFBQVEsQ0FBQ0UsS0FBVCxDQUFlQyxlQUFmLENBQStCQyxHQUEvQixDQUFvQyxzQkFBcEMsRUFBNERDLFdBQUQsSUFBaUI7QUFD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QUE0QixLQUFLM0IsTUFBTCxDQUFZUyxJQUFaLENBQWlCeUIsR0FBakIsR0FBd0IseUNBQXBEO0FBQ0QsU0E1QkQ7QUE2QkQ7QUFFRixLQWxFRCxNQW1FSztBQUFDVCxNQUFBQSxPQUFPLENBQUNFLEdBQVIsQ0FBWSxlQUFaO0FBQTZCO0FBQ3BDOztBQTFFbUMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcbnJlcXVpcmUoJ0BiYWJlbC9wb2x5ZmlsbCcpXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV4dFdlYnBhY2tQbHVnaW4ge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgdGhpcy5wbHVnaW4gPSByZXF1aXJlKGAuL3BsdWdpblV0aWxgKS5fY29uc3RydWN0b3Iob3B0aW9ucylcbiAgfVxuICBhcHBseShjb21waWxlcikge1xuICAgIHJlcXVpcmUoJy4vcGx1Z2luVXRpbCcpLmxvZ3YodGhpcy5wbHVnaW4ub3B0aW9ucywnRlVOQ1RJT04gYXBwbHknKVxuICAgIGlmIChjb21waWxlci5ob29rcykge1xuXG4gICAgICBjb21waWxlci5ob29rcy50aGlzQ29tcGlsYXRpb24udGFwKGBleHQtdGhpcy1jb21waWxhdGlvbmAsIChjb21waWxhdGlvbikgPT4ge1xuICAgICAgICByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2KHRoaXMucGx1Z2luLm9wdGlvbnMsJ0hPT0sgdGhpc0NvbXBpbGF0aW9uJylcbiAgICAgICAgaWYgKHRoaXMucGx1Z2luLnZhcnMucGx1Z2luRXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb21waWxhdGlvbi5lcnJvcnMucHVzaCggbmV3IEVycm9yKHRoaXMucGx1Z2luLnZhcnMucGx1Z2luRXJyb3JzLmpvaW4oXCJcIikpIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvL3RoaXMucGx1Z2luLnZhcnMuZGVwcyA9IFtdXG4gICAgICAgIH1cbiAgICAgIH0pXG5cbiAgICAgIGlmICh0aGlzLnBsdWdpbi52YXJzLnBsdWdpbkVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBpZiAoIHRoaXMucGx1Z2luLnZhcnMuZnJhbWV3b3JrID09ICdleHRqcycpIHtcbiAgICAgICAgY29tcGlsZXIuaG9va3MuYWZ0ZXJDb21waWxlLnRhcCgnZXh0LWFmdGVyLWNvbXBpbGUnLCAoY29tcGlsYXRpb24pID0+IHtcbiAgICAgICAgICByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2KHRoaXMucGx1Z2luLm9wdGlvbnMsJ0hPT0sgYWZ0ZXJDb21waWxlJylcbiAgICAgICAgICByZXF1aXJlKGAuL2V4dGpzVXRpbGApLl9hZnRlckNvbXBpbGUoY29tcGlsYXRpb24sIHRoaXMucGx1Z2luLnZhcnMsIHRoaXMucGx1Z2luLm9wdGlvbnMpXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgY29tcGlsZXIuaG9va3MuY29tcGlsYXRpb24udGFwKGBleHQtY29tcGlsYXRpb25gLCAoY29tcGlsYXRpb24pID0+IHtcbiAgICAgICAgICByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2KHRoaXMucGx1Z2luLm9wdGlvbnMsJ0hPT0sgY29tcGlsYXRpb24nKVxuICAgICAgICAgIHJlcXVpcmUoYC4vcGx1Z2luVXRpbGApLl9jb21waWxhdGlvbihjb21waWxlciwgY29tcGlsYXRpb24sIHRoaXMucGx1Z2luLnZhcnMsIHRoaXMucGx1Z2luLm9wdGlvbnMpXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIGlmKCF0aGlzLnBsdWdpbi5vcHRpb25zLmdlblByb2REYXRhKSB7XG4gICAgICAgIGNvbXBpbGVyLmhvb2tzLmVtaXQudGFwQXN5bmMoYGV4dC1lbWl0YCwgKGNvbXBpbGF0aW9uLCBjYWxsYmFjaykgPT4ge1xuICAgICAgICAgIHJlcXVpcmUoJy4vcGx1Z2luVXRpbCcpLmxvZ3YodGhpcy5wbHVnaW4ub3B0aW9ucywnSE9PSyBlbWl0JylcbiAgICAgICAgICByZXF1aXJlKGAuL3BsdWdpblV0aWxgKS5lbWl0KGNvbXBpbGVyLCBjb21waWxhdGlvbiwgdGhpcy5wbHVnaW4udmFycywgdGhpcy5wbHVnaW4ub3B0aW9ucywgY2FsbGJhY2spXG4gICAgICAgIH0pXG5cbiAgICAgICAgY29tcGlsZXIuaG9va3MuZG9uZS50YXAoYGV4dC1kb25lYCwgKCkgPT4ge1xuICAgICAgICAgIHJlcXVpcmUoJy4vcGx1Z2luVXRpbCcpLmxvZ3YodGhpcy5wbHVnaW4ub3B0aW9ucywnSE9PSyBkb25lJylcblxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2hlcmUnKVxuICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMucGx1Z2luLnZhcnMucHJvZHVjdGlvbilcbiAgICAgICAgICBpZiAodGhpcy5wbHVnaW4udmFycy5wcm9kdWN0aW9uICYmICF0aGlzLnBsdWdpbi5vcHRpb25zLmdlblByb2REYXRhICYmIHRoaXMucGx1Z2luLm9wdGlvbnMuZnJhbWV3b3JrID09ICdhbmd1bGFyJykge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignY2xlYW4gdXAgbmVlZGVkJylcbiAgICAgICAgICB9IFxuXG5cblxuXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmKHRoaXMucGx1Z2luLm9wdGlvbnMuYnJvd3NlciA9PSB0cnVlICYmIHRoaXMucGx1Z2luLm9wdGlvbnMud2F0Y2ggPT0gJ3llcycgJiYgdGhpcy5wbHVnaW4udmFycy5wcm9kdWN0aW9uID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIGlmICh0aGlzLnBsdWdpbi52YXJzLmJyb3dzZXJDb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgIC8vaWYgKHRoaXMucGx1Z2luLnZhcnMuYnJvd3NlckNvdW50ID09IDAgJiYgY29tcGlsYXRpb24uZXJyb3JzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9ICdodHRwOi8vbG9jYWxob3N0OicgKyB0aGlzLnBsdWdpbi5vcHRpb25zLnBvcnRcbiAgICAgICAgICAgICAgICByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2codGhpcy5wbHVnaW4udmFycy5hcHAgKyBgT3BlbmluZyBicm93c2VyIGF0ICR7dXJsfWApXG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4udmFycy5icm93c2VyQ291bnQrK1xuICAgICAgICAgICAgICAgIGNvbnN0IG9wbiA9IHJlcXVpcmUoJ29wbicpXG4gICAgICAgICAgICAgICAgb3BuKHVybClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSlcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVxdWlyZSgnLi9wbHVnaW5VdGlsJykubG9nKHRoaXMucGx1Z2luLnZhcnMuYXBwICsgYENvbXBsZXRlZCBleHQtd2VicGFjay1wbHVnaW4gcHJvY2Vzc2luZ2ApXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICB9XG4gICAgZWxzZSB7Y29uc29sZS5sb2coJ25vdCB3ZWJwYWNrIDQnKX1cbiAgfVxufVxuIl19